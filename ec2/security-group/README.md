# 보안그룹(Security Group)

**기록 ✍️**

#### author : jung yuha

#### first registered : 2023-06-19 Mon

#### last modified : 2023-06-19 Mon



## \[1] 보안그룹이란?

<figure><img src="../../.gitbook/assets/image (52).png" alt=""><figcaption><p> 보안그룹</p></figcaption></figure>

* EC2 인스턴스에 대한 인바운드(들어오는) 및 아웃바운드(나가는) 트래픽을 제어하는 가상 방화벽 역할
* EC2 인스턴스의 ENI(네트워크 인터페이스)와 연결 됨
* 보안 그룹은 허용 규칙만 지정 가능하고 거부 규칙은 지정할 수 없음
  * &#x20;보안 그룹에 없는 규칙은 기본적으로 거부가 된다.
  * 허용 규칙만 추가할 수 있다.
* 보안 그룹은 연결 상태를 추적하는 상태저장 방화벽 (Stateful Firewall)이다.

## \[2] 보안그룹 설정

**인바운드 트래픽 : 외부에서 EC2 인스턴스로 들어오는 트래픽**

**아웃바운드 트래픽 : EC2 인스턴스에서 외부로 나가는 트래픽**

위 두가지 트래픽을 인바운드 규칙과 아웃바운드 규칙으로 제어를 하게된다.

<figure><img src="../../.gitbook/assets/image (63).png" alt=""><figcaption><p> 인바운드 규칙 </p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (60).png" alt=""><figcaption><p> 아웃바운드 규칙</p></figcaption></figure>

### 제어 규칙

1. 트래픽 유형 (예 : RDP , SSH, HTTP 등)
2. 프로토콜 (TCP, UDP 등)
3. 포트 (예 , SSH 22, HTTP 80, HTTPS 443, MySQL 3306 등)
   * 인스턴스 원격 접속시 SSH 22 포트를 사용한다.
   * 웹 접속시 HTTP 80 포트를 사용한다.
   * 보안 웹 접속시 HTTP 443 포트를 사용한다.
   * SQL 데이터베이스 접속시 MYSQL 3306 포트를 사용한다.
4. 대상 : 개별 IP 주소 , IP 주소대역(CIDR Block) , 다른 보안 그룹 , AWS에서 IP 주소를 모아놓은 것(Prefix List)

## \[3] 보안그룹 Stateful Firewall(상태저장 방화벽) 특징&#x20;

### 예시 1 : 인바운드로 트래픽이 허용되는 경우

<figure><img src="../../.gitbook/assets/image (46).png" alt=""><figcaption><p> 예시 1 : 인바운드로 트래픽이 허용되는 경우</p></figcaption></figure>

아웃바운드 규칙에 상관없이 , 허용된 인바운드 트래픽에 대한 반응으로 외부로 나가는 흐름이 수행된다.

* **인바운드** : EC2 인스턴스가 있고 클라이언트가 있을 때 클라이언트가 EC2 인스턴스에 접속하는 것&#x20;
* EC2 인스턴스가 웹서버라고 가정한다.(HTTP 80)
* 인바운드 규칙에 HTTP 80번 포트를 모든 소스 (0.0.0.0/0)로 부터의 인바운드를 허용한다고 지정한다.
  * IP 주소 0.0.0.0/0 은 모든 IPV4 주소이다.
* 클라이언트가 해당 웹서버에 접속을 할 때 EC2 인스턴스는 return 트래픽(아웃바운드 트래픽)을 보내주어야한다.
* 인바운드에서 허용이 되면 아웃바운드에서 따로 제어를 하지 않으므로 허용 규칙을 안 적어도 된다.
* 즉, 한쪽만 허용해도 반대편 리턴하는 트래픽은 보안그룹에서 체크하지 않는다.

### 예시 2 : 아웃바운드로 트래픽이 허용되는 경우

<figure><img src="../../.gitbook/assets/image (40).png" alt=""><figcaption><p> 예시 2 : 아웃바운드로 트래픽이 허용되는 경우</p></figcaption></figure>

사용자가 인스턴스에서 요청을 전송하면 해당 요청의 응답 트래픽은 인바운드 보안그룹 규칙에 관계없이 인바운드 흐름이 허용된다.

* 인바운드는 트래픽을 체크하지 않고 자동으로 허용된다.
* EC2인스턴스가 외부에 있는 클라이언트(구글.다음..) 웹서버에 접속할 때 80번 포트가 허용이 되어있으면 인바운드에 규칙을 지정하지 않아도 자동으로 허용된다.
